%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%	Notations Systeme Linéaire Continus Invariants
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{Raf_Notations_SLCI}[2014/03/05]
 
%chargement des extensions requises au bon fonctionnement de l'extension et des documents
\RequirePackage{ifthen}%pour utiliser les booléens, à mettre avec les autres RequirePackage's
\RequirePackage{mathrsfs}			%Pour faire des maths (notamment le L de la transformée de Laplace)
\RequirePackage{xargs}		%Pour faire des fonctios à arguments multiples
\RequirePackage{bodegraph}
\RequirePackage{schemabloc}
\RequirePackage{Raf_Notations_Maths}


%Initialisation des booleens 
\newboolean{boolRaccourcisSLCI}%création du booléen
\setboolean{boolRaccourcisSLCI}{true}%affectation de la valeur false

%déclaration des options de l'extension
\DeclareOption{noRaccourci}{\setboolean{boolRaccourcisSLCI}{false}}
\ProcessOptions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%commandes et/ou environnements personnalisés
 
%Raccourcis
\newcommand* {\FTBO} {fonction de transfert en boucle ouverte}
\newcommand* {\FTBF} {fonction de transfert en boucle fermée}

%Opérateur
\newcommand*{\transfoLaplace}[2][]	{\ensuremath{\mathscr{L}^{#1}\ifthenelse{\equal{#2}{}}{}{\left[#2\right]}}}	%Transformée de Laplace (anciennement un L barré)
\newcommand*{\transfoLaplaceInv}[1]	{\transfoLaplace[-1]{#1}}	%Transformée de Laplace (anciennement un L barré)


%Fonctions temporelles
\newcommand* {\echelon}[1][t]	{\ensuremath{\mathbf{\f u{#1}}}}
\newcommand* {\rampe}[1][t]	{\ensuremath{\mathbf{\f r{#1}}}}
\newcommand* {\dirac}[1][t]	{\ensuremath{\mathbf{\f \delta{#1}}}}
\newcommand*	{\Fft}[1][]			{\f {f_{#1}}{t}}
\newcommand*	{\Fst}[1][]			{\f {s_{#1}}{t}}
\newcommand*	{\Fstc}[1][]			{\f {\underline{s}}{t}}
\newcommand*	{\Fet}[1][]			{\f {e_{#1}}{t}}
\newcommand*	{\Fetc}[1][]			{\f {\underline{e}}{t}}
\newcommand*	{\Fpt}[1][]			{\f {p_{#1}}{t}}
\newcommand*	{\Fyt}[1][]			{\f {y_{#1}}{t}}
\newcommand*	{\Fut}[1][]			{\f {u_{#1}}{t}}
\newcommand*	{\Fvt}[1][]			{\f {v_{#1}}{t}}
\newcommand*	{\Fxt}[1][]			{\f {x_{#1}}{t}}
\newcommand*	{\Fit}[1][]			{\f {i_{#1}}{t}}
\newcommand*	{\Fumt}				{\f {u_m}{t}}
\newcommand*	{\Fcmt}				{\f {c_m}{t}}
\newcommand*	{\Fwmt}				{\f {\omega_m}{t}}



%Fonctions laplace
\newcommand* {\ECHELON}[1][p]	{\ensuremath{\mathbf{\f U{#1}}}}
\newcommand* {\RAMPE}[1][p]	{\ensuremath{\mathbf{\f R{#1}}}}
\newcommand*	{\FFp}[1][]		{\f {F_{#1}}{p}}
\newcommand*	{\FYp}[1][]		{\f {Y_{#1}}{p}}
\newcommand*	{\FXp}[1][]		{\f {X_{#1}}{p}}
\newcommand*	{\FIp}[1][]		{\f {I_{#1}}{p}}
\newcommand*	{\FSp}[1][]		{\f {S_{#1}}{p}}
\newcommand*	{\FEp}[1][]		{\f {E_{#1}}{p}}
\newcommand*	{\FDp}[1][]		{\f {D_{#1}}{p}}	%Dénominateur
\newcommand*	{\FNp}[1][]		{\f {N_{#1}}{p}}	%Numérateur
\newcommand*	{\FHp}[1][]		{\f {H_{#1}}{p}}	%Fonction de transert
\newcommand*	{\Hjw}[1][]		{\f {H_{#1}}{j\omega}}	%Fonction de transert
\newcommand*	{\FGp}[1][]		{\f {G_{#1}}{p}}	%
\newcommand*	{\FCp}[1][]		{\f {C_{#1}}{p}}	%
\newcommand*	{\FTp}[1][]		{\f {T_{#1}}{p}}	%
\newcommand*	{\FUp}[1][]		{\f {U_{#1}}{p}}	%
\newcommand*	{\FVp}[1][]		{\f {V_{#1}}{p}}	%
\newcommand*	{\FUmp}			{\f {U_{m}}{p}}	%
\newcommand*	{\FWmp}			{\f {\Omega_m}{p}}	%
\newcommand*	{\FWrp}			{\f {\Omega_r}{p}}	%
\newcommand*	{\Fepsp}[1][]		{\f {\varepsilon_{#1}}{p}}	%
\newcommand*	{\FTBFp}[1][]		{\f {{FTBF}_{#1}}{p}}	%
\newcommand*	{\FTBOp}[1][]		{\f {{FTBO}_{#1}}{p}}	%

%Fréquetiel
\newcommand*	{\Gw}[1][\omega]			{\f G{#1}}
\newcommand*	{\Gdbw}[1][\omega]			{\f {G_{db}}{#1}}
\newcommand*	{\phiw}[1][\omega]			{\f\phi{#1}}
\newcommand*	{\wCoupure}[1][]	{\ensuremath{{\omega_c}_{#1}}}
\newcommand*	{\wResonance}[1][]	{\ensuremath{{\omega_r}_{#1}}}


%Forme canonique
\newcommandx*{\canonique}[4][2=K,3=,4=z]	{
				\ifthenelse{\equal{#1}{1}}
					{\ensuremath{\frac{#2}{1+\ifthenelse{\equal{#3}{}}{\tau}{#3} p}}}
					{}
				\ifthenelse{\equal{#1}{2}}
					{\ensuremath{\frac{#2}{\frac 1{{\ifthenelse{\equal{#3}{}}{\omega_0}{#3}}^2}p^2+\frac{2#4}{\ifthenelse{\equal{#3}{}}{\omega_0}{#3}}p+1}}}
					{}
				}

%Valeurs
\newcommand* {\erreurStatique}	{\ensuremath{\varepsilon_S}}
\newcommand* {\eStatique}	{\erreurStatique}
\newcommand* {\erreurTrainage}	{\ensuremath{\varepsilon_V}}
\newcommand* {\eTrainage}	{\erreurTrainage}
\newcommand* {\erreurDynamique}	{\ensuremath{\varepsilon_S}}
\newcommand* {\eDynamique}	{\erreurDynamique}
\newcommand* {\tempsReponse}	{\ensuremath{t_r^{5\%}}}
\newcommand* {\tReponse}	{\tempsReponse}




%Schema bloc (appuyé sur le package de Papanicola)

\definecolor{fond_blocs}{RGB}{255,246,228} %Couleur du fond
\sbStyleBloc{fill=fond_blocs}% Style par défaut des blocs
\newcommandx*{\blocSeul}[5][2=5,4=5]	{\begin{tikzpicture}
					\sbEntree{E}	%Point de départ
					\sbBloc[#2]{monBloc}{#3}{E}	%Le bloc
					\sbRelier[#1]{E}{monBloc}%Premier lien
					\sbSortie[#4]{S}{monBloc}%Le point de sortie
					\sbRelier[#5]{monBloc}{S}%2eme lien
				\end{tikzpicture}}


%Raccourcis
\ifthenelse{\boolean{boolRaccourcisSLCI}}
	{
		\newcommand*{\TOR}	{tout-ou-rien}
		\renewcommand*{\L}[2][]	{\transfoLaplace[#1]{#2}}	%Transformée de Laplace (anciennement un L barré)
		\newcommand*{\LInv}[1] {\transfoLaplaceInv{#1}}	%Transformée de Laplace (anciennement un L barré)

		\newcommand*	{\Fp}[1][]		{\FFp[#1]}
		\newcommand*	{\Yp}[1][]		{\FYp[#1]}
		\newcommand*	{\Xp}[1][]		{\FXp[#1]}
		\newcommand*	{\Sp}[1][]		{\FSp[#1]}
		\newcommand*	{\Ep}[1][]		{\FEp[#1]}
		\newcommand*	{\Dp}[1][]		{\FDp[#1]}	%Dénominateur
		\newcommand*	{\Np}[1][]		{\FNp[#1]}	%Numérateur
		\newcommand*	{\Hp}[1][]		{\FHp[#1]}	%Fonction de transert
		\newcommand*	{\Gp}[1][]		{\FGp[#1]}	%
		\newcommand*	{\Cp}[1][]		{\FCp[#1]}	%
		\newcommand*	{\Up}[1][]		{\FUp[#1]}	%
		\newcommand*	{\Ump}			{\FUmp}	%
		\newcommand*	{\Wmp}			{\FWmp}	%
		\newcommand*	{\Wrp}			{\FWrp}	%
		\newcommand*	{\epsp}[1][]		{\Fepsp[#1]}	%

		\newcommand*	{\ft}[1][]		{\Fff[#1]}
		%\newcommand*	{\st}[1][]		{\f {s_{#1}}{t}}
		\newcommand*	{\stc}[1][]		{\Fstc[#1]}
		\newcommand*	{\et}[1][]		{\Fet[#1]}
		\newcommand*	{\etc}[1][]		{\Fetc[#1]}
		%\newcommand*	{\yt}[1][]		{\f {y_{#1}}{t}}
		%\newcommand*	{\xt}[1][]		{\f {x_{#1}}{t}}
		\newcommand*	{\itt}[1][]		{\Fit}
		\newcommand*	{\umt}			{\Fumt}
		\newcommand*	{\ut}			{\Fut}
		\newcommand*	{\vt}			{\Fvt}
		\newcommand*	{\cmt}			{\Fcmt}
		\newcommand*	{\wmt}			{\Fwmt}
		\newcommand*	{\wC}			{\wCoupure}
		\newcommand*	{\wR}			{\wResonance}
	}


%BODE
%-------------------------------

\newenvironmentx{bodeGain}[6][1=-1,2=4,3=-20,4=20,5=2,6=0.2]%1=10^x_min   2=10^x_max    3=Gdb_min    4=Gdb_max   5=xscale   6=yscale
		{
			\begin{tikzpicture}[xscale=#5,yscale=#6]
				\UnitedB
				\semilog{#1}{#2}{#3}{#4}
				%Begin magouille (parce que ifthen n'aime pas comparer des flottant, alors on les transforme en dimensions....)
				\ifthenelse{\lengthtest{#1pt < 0pt} \or \lengthtest{#1pt = 0pt} \and \lengthtest{#2pt > 0pt} \or \lengthtest{#2pt = 0pt}}
					{\draw[->] (0,#3) -- (0,#4);}
					{}
				\ifthenelse{\lengthtest{#3pt < 0pt} \or \lengthtest{#3pt = 0pt} \and \lengthtest{#4pt > 0pt} \or \lengthtest{#4pt = 0pt}}
					{\draw[->] (#1,0) -- (#2,0);}
					{}
		}
		{
			\end{tikzpicture}
		}
\newenvironmentx{bodePhase}[6][1=-1,2=4,3=-190,4=20,5=2,6=0.03]%1=10^x_min   2=10^x_max    3=Gdb_min    4=Gdb_max   5=xscale   6=yscale
		{
			\begin{tikzpicture}[xscale=#5,yscale=#6]
				\UniteDegre
				\OrdBode{10}%Pas des graduactions vertiales
				\semilog{#1}{#2}{#3}{#4}
				%Begin magouille (parce que ifthen n'aime pas comparer des flottant, alors on les transforme en dimensions....)
				\ifthenelse{\lengthtest{#1pt < 0pt} \or \lengthtest{#1pt = 0pt} \and \lengthtest{#2pt > 0pt} \or \lengthtest{#2pt = 0pt}}
					{\draw[->] (0,#3) -- (0,#4);}
					{}
				\ifthenelse{\lengthtest{#3pt < 0pt} \or \lengthtest{#3pt = 0pt} \and \lengthtest{#4pt > 0pt} \or \lengthtest{#4pt = 0pt}}
					{\draw[->] (#1,0) -- (#2,0);}
					{}
		}
		{
			\end{tikzpicture}
		}




\endinput